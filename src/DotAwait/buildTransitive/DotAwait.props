<Project>
  
  <PropertyGroup>
    <DotAwaitImplicitUsings Condition="'$(DotAwaitImplicitUsings)'==''">enable</DotAwaitImplicitUsings>
    <DotAwaitImplicitUsings>$([System.String]::Copy('$(DotAwaitImplicitUsings)').ToLowerInvariant())</DotAwaitImplicitUsings>
  </PropertyGroup>

  <!-- validation -->
  <Target Name="ValidateDotAwaitImplicitUsings" BeforeTargets="PrepareForBuild">
    <Error
      Condition="'$(DotAwaitImplicitUsings)' != 'enable' and '$(DotAwaitImplicitUsings)' != 'disable'"
      Text="DotAwaitImplicitUsings must be 'enable' or 'disabled'. Current value: '$(DotAwaitImplicitUsings)'." />
  </Target>

  <ItemGroup Condition="'$(DotAwaitImplicitUsings)' == 'enable'">
    <Using Include="DotAwait" />
  </ItemGroup>

  <!-- Hide content files -->
  <ItemGroup>
    <Compile Update="@(Compile)">
      <Visible Condition="'%(NuGetItemType)' == 'Compile' and '%(NuGetPackageId)' == 'DotAwait'">false</Visible>
    </Compile>
  </ItemGroup>

</Project>
